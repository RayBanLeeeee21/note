#chapter 01 分布式系统的特征

## 分布式系统
重要特征:
* 组件并发性
* 缺乏全局时钟
* 故障独立性

动机: **资源共享**: 资源可以被客户访问, 也可以封装成对象被其它对象访问

挑战: 
* 组件异构性
* 开放性 (可增加/替换组件)
* 安全性
* 可伸缩性
* 故障处理
* 组件并发性
* 透明性
* 提供服务质量

## 1.1 简介

分布式系统定义: 
* 硬件和软件组件**分布在网络上**
* 组件之前通过**传递信息进行通信和动作协调**的系统

分布式系统特征:
* 并发: 
    * 系统处理共享资源的能力随着网络资源的增加而提高, 同时需要**对并发访问资源的程序进行协调**.
* 缺乏全局时间: 
    * 组件之间的协调通常取决于对于程序动作发生时间的共识, 但通过传递消息来进行同步的**精度是有限**的.
* 故障独立性:
    * 当一个组件无法与其它组件正常通信时, 无法确定是因为**网络故障**还是**组件的故障**
    * 当一个组件发生故障时, 网络上其它组件不能立即得知

共享资源:
* 硬件:
    * 硬盘
    * 打印机
* 软件:
    * 文件
    * 程序
    * 数据库
    * 数据对象

## 1.2 分布式系统的例子

### 1.2.1 Web搜索

Web搜索: 为万维网的所有资源**建立索引**
* 对基础设施的要求:
    * 底层物理设施: 超大数目的位于世界多个数据中心的联网计算机
    * 分布式文件系统: 支持超大文件, 对搜索及其它应用的使用方法(快速而持久的读取)的优化
    * 结构化分布式存储系统: 提供对超大数据集的快速访问
    * 锁服务: 分布式锁和协定等服务
    * 编程模式: 基于底层物理设施的, 提供超大并行与分布式计算的计算

### 1.2.2 MMOG(Massively Multiplayer Online Game):
**C/S体系结构** (游戏EVE Online):
* **集群结构**的**集中式服务器**: 逻辑上为一个集中式服务器, 物理结构包括上百个计算结点
    * **单个拷贝**:游戏世界状态只有一份拷贝, 简化一致性问题
    * **负载均衡**, 高负载星系有自己的计算机

**分布式体系结构**: (游戏EverQuest)
* **分散部署**: 服务器分布在不同地理位置
    * 用户根据网络延迟被动态分配到特定的服务器上

**对等技术 (P2P)**: 
* **对等**: 每个参与者贡献硬件资源(硬盘, 处理器)来容纳游戏

### 1.2.3 金融系统 

金融系统
* 特点: **实时**访问大范围信息源
* 重点: 对 **感兴趣数据项 (事件)** 的处理和通信, 可靠及时地传递事件给感兴趣的用户
* 交易活动监控

**分布式基于事件的系统**
* 难点:
    * 事件源多样性: 解决方案: 用**适配器**把不同事件格式转换成统一的内部格式
        * **格式**多样性: 数据格式不同
        * **技术**多样性 (**异构**)
    * 实时性

## 1.3 分布式系统的趋势

分布式系统的趋势:
* 泛在网络: 无所不在, 无所不包, 无所不能
* 无所不在计算
* 对多媒体设备需求的增加
* 把分布式系统**作为一个设施**

### 1.3.1 - 1.3.2

现代互联网:
* 多种类型计算机网络互连
* 通过**协议**来实现公共的通信手段
* **开放的服务集**: 可随新服务的增加而

防火墙: 通过过滤出入的消息来保存LAN
互联网服务提供商(Internet Service Provider): 给个人用户和企业组织提供宽带服务

移动计算: 
* 可以在**移动**中或者某些**非常规环境**中执行计算任务
    * **位置感知/上下文感知**: 以**对用户透明**的方式自动发现, 切换服务网点

无处不在计算:
* 充分利用身边的小型设备执行计算任务
    * **服务发现**: 设备之间可以方便地**自发互操作**, 即使是访问过的环境
        * **自发互操作**指设备之间例行地创建, 拆除关联

位置感知与服务发现相比, 其对用户是透明的


### 1.3.3 分布式多媒体系统

功能支持:
* 支持**离散类型媒体**: 图片, 文档等, 提供**传输**, **存储**, **展示**功能
* 支持**连续类型媒体**: 视频, 音频, 提供**传输**, **存储**, **展示**功能
    * **实时性**: 连续类型媒体带有时间维度, 要保证传输的实时性


对基础设施的要求:
* 格式支持: 编解码, 加密等
* **质量保证**
    * **资源管理策略**: 如调度策略, 用于支持质量保证
    * **适配策略**: 在质量无法保证时作为补充


### 1.3.4 把分布式计算作为公共设施

把分布式计算作为公共设施
* IaaS (Infrastructure as a Service): 利用互联网中提供的**计算**, **存储**等服务
* SaaS (Software as a Service): 利用互联网中提供的软件服务, 如电子邮件, 日历等


云计算: 一组基于**互联网**的应用, 足以满足大多数用户对**计算**和**存储**的需求, 减少用户对本地存储和计算资源的使用
* 服务通常根据使用而非购买来支付
* 用户的设备和界面可以简单
* 基础设施--**集群服务器**: 
    * 互连的计算机集合, 提供单一, 集成的高性能计算能力
    * 通常部署在一个**局域网**
    * 最小单元--**刀片服务器**: 包含处理和存储功能的基本单元

## 1.4 资源共享
服务与服务器
* 服务: 计算机系统中**管理相关资源**并且**提供功能**给用户和应用的一个独立的部分.
* 服务器: 在连网计算机中的一个程序, 接收用户的请求, 执行服务, 对资源进行管理, 并回复相关的响应

## 1.5 挑战

### 1.5.1 异构性

异构性:
* 网络异构: 通过网络协议来保持一致
* 硬件异构: 如大端小端的差异, 指令集的差异等
* 操作系统异构: 相同的网络协议可以让不同的操作系统进行通信, 但操作系统可以提供不同的编程实现 
* 编程语言异构: 不同语言相互调用时, 要约定数据的表示方式
* 软件实现异构: 不同软件通信时, 要约定一致的接口(标准)

中间件: 一个软件层, 提供**抽象的接口**, 隐藏网络 / 硬件 / 操作系统 / 编程语言的异构

移动代码: 能从一台计算机发送到另一台计算机中进行执行的代码, 如Java applet
* 异构性: 有些语言编译的程序不能在不同的硬件上执行, 因为指令集不同
* 虚拟机: 有些语言可以编译成统一的虚拟机代码, 由虚拟机以解释的方式执行

### 1.5.2 开放性

**开放性**: 开放性是决定系系统能否被**扩展**和**重新实现**的特征
* 前提: **发布系统的关键接口**: 开发者能获得系统组件的关键软件接口的规约和文档
  
开放性系统的特征:
* 发布系统的关键接口
* 基于**一致的通信机制**和**接口访问**实现 
* 能用不同销售商提供的**异构软件和硬件**实现 

### 1.5.3 安全性
安全性
* 机密性: 拒绝未授权用户访问敏感资源, 
    * 涉及**加密**等技术
* 完整性: 保证接收的信息未经篡改或破坏
    * 移动代码的安全性
* 可用性: 防止对访问资源的手段的干扰
    * DoS攻击

### 1.5.4 可伸缩性
可伸缩性: 系统可以在不同规模的访问下, 保持有效 & 高效的运转

主要挑战:
* 控制物理资源开销: 对资源的访问量增长时, 服务器的数量与访问量的关系至少是线性的(可能更高)
* 减少性能损失: 减少软件设计问题造成的性能损失, 压榨机器的性能
    * 如用搜索树代替线性查找表
* 防止软件资源用尽: 
    * 如IP地址分配, 发号器, 日期的数据格式等
* 避免性能瓶颈: 算法尽可能是分散型的, 可以随服务器的数量增加而水平扩展
    * 如DNS服务器的域名表不能只在一个服务器上

### 1.5.5 故障处理

故障处理技术:
* 故障检测:
    * 检验和
    * 死锁检测
* 故障掩盖: 让故障对用户透明
    * 消息重传
    * 双磁盘保存文件 (前提是能检测到故障)
* 容错: 对错误能容忍, 出错时有对应的处理方式
    * 客户端可以设计为容错, 如长时间未响应时, 不能一直等待, 而是告知用户
* 冗余: 通过硬件资源的冗余来保证容错
    * 多个路由
    * 多个DNS的冗余域名表
    * 多个数据库的相同数据
* 故障恢复: 在故障发生后, 可进行回滚或者恢复, 保证数据的一致性

**可用性**度量: 系统能够提供服务的时间占总时间的比例

### 1.5.6 并发性
并发性: 共享资源在高并发的访问后, 能够保持一致性
* 信号量

### 1.5.7 透明性

**透明性**: 系统对**用户**和**开发者**隐藏系统组件的**分离性**
* **网络透明性**
    * 访问透明性: 对资源的访问方式相同
    * 位置透明性: 资源的实际位置透明, 如URL
* 移动透明性: 资源位置或客户移动时, 不影响访问的过程
* 复制透明性: 资源的副本对用户或者开发者不可见
* 故障透明性
* 性能透明性: 系统在负载改变时, 可以改变配置以提高性能, 但不影响资源的访问
* 伸缩透明性: 系统的伸缩对于用户和**开发者**不可见

### 1.5.8 服务质量

服务质量:
* 可靠性
* 安全性
* 性能
    * 及时性(实时性)
    * 计算吞吐量