# Chapter 15 数据流与窗口管理


通信类型:
- 大批量数据
- 交互式数据

## 15.3 延时确认


## 15.4 Nagle算法

Nagle算法: 要求TCP连接上只能有一个未确认的分组, 在这个ACK到达之前将小分组收集起来, 直到ACK到达再将积攒起来的小分组发出去


Nagle算法发送条件:
- 包长度达到MSS直接发送
- 有FIN直接发送
- 先前发送的小分组都被确认, 可以发送出去
- 超时未达到以上条件发送


### 15.5.2 零窗口与TCP持续计时器

零窗口: 当接收端的接收缓存没有空间时, 通过**零窗口通告**来阻塞发送端发送
- 恢复: 回复一个窗口值不为0的ACK, 通常没有数据
- 持续计时器: 发送端要定时发**窗口探测**报文, 防止接收端宕机却未察觉, 一直等待
    - 也有指数退避机制
    - 相关攻击: 攻击方可以针对该计时器进行攻击, 以较小的代价占用掉发送方的资源
### 15.5.3 糊涂窗口综合征

糊涂窗口综合征(Silly Window Syndrome): 发送端/接收端未感知到对方的窗口特别小
- 原因: 
    - 发送端: 每次产生的数据很小, 立即发送
    - 接收端: 接收端消耗速度慢, 每次通告的窗口值都很小

解决方法
- 接收端: 不能通告很小的窗口值. 直到缓存区有大于等于一半的空间再通告
    - Clack解决方法: 有数据到就确认, 但通告窗口值为0, 只到有足够的空间才
    - 延迟确认
- 发送端:
    - nagle算法
    - 全长(MSS)报文可发送
    - 数据段 >= 1/2 接收端最大窗口值可发送
    - 非预期ACK可发送(要求重传)
