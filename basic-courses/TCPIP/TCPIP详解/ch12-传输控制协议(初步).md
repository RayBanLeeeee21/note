# Chapter 12 传输控制协议(初步)


问题 & 解决方法:
- Q: 出错 & 丢失 & 重复 & 失序
    - A: ARQ(序号 + ACK号 + 重试) + 校验码
    - Q: **停止等待协议**吞吐量小
        - A: 滑动窗口 & 批量回复 & 选择重发(SACK)
    - Q: 等待多久
    - A: 往返时间估计算法


滑动窗口的作用:
- 增大吞吐量
- 流量控制: 协调两边的速率


TCP模型:
- 面向字节流
    - 组包
- 面向连接
- 可靠性: 保证不丢失, 不重复, 不失序, 不出错
    - 检验和 & ARQ
- 全双工: 两边都有缓冲区(窗口), 序号, ack


报文头
- 源端口 & 目的端口
-  序号 & ACK & ack 标志 
    - SEQ & ACK: 32 bit. 以字节为单位, 循环使用. 
        - 时间戳选项(TSOPT)可以用来防回绕
    - SEQ: 已写入报文的**第一个**字节序号
    - ACK: 期望对方回复的下一组报文的**第一个**字节
- TCP报文头长度(占4bit): 单位为32位字, 范围为20byte-60byte
- 保留(4bit)
- 控制字段(ACK, URG, SYN, FIN, RST等)
- 窗口大小(16bit) 最大65535
    - 可以用窗口缩放选项来扩大(WSOPT)


TCP选项
- 最大段(MSS)
- 选择确认选项(SACK)
- 窗口缩放选项(WSOPT)
- 时间戳(TSOPT) 
    - 计算RTT用
    - 防回绕
- 用户超时选项
- 
