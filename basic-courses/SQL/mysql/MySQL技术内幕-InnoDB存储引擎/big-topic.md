
### 引擎

innoDB & MyISAM对比
- 事务:
    - MyISAM不支持事务
    - innoDB支持事务, autocommit时所有语句都封闭成事务
- 外键:
    - MyISAM不支持外键
    - innoDB支持外键
        - 相关问题: 外键实现方法(强制建索引, S锁)
- 索引:
    - MyISAM用B+Tree, 但数据和索引分开, 索引叶结点存的是指针
    - innoDB**索引即数据**, 数据直接放叶结点, 并且一定要有主键, 用聚集索引实现主键
        - 辅助索引放主键
- 行数: 
    - MyISAM记录行数
        - MyISAM只有表锁, 可以通过表锁保证行数与实际行数一致
    - innoDB不记录行数, 统计要全表扫描
        - 行数对于不同事务来说可能不一样
- 压缩:
    - MyISAM的数据文件可以被压缩后查询(但压缩后不能修改)
- 文件
    - MyISAM: frm MYD(数据文件) MYI(索引文件)
    - innodb: frm ibd(表空间)
- 锁:
    - MyISAM支持表锁, innoDB支持行级页 & 表锁


## 索引

索引
- B树 & B+树 & 红黑树对比
- 为什么不用B树或者红黑树?
    - B+树所有数据都放在叶子结点, 拆分结点时也基本不怎么移动叶子结点, 既能保证按key查询时的效率, 又能使全表扫描过程尽可能连续地访问磁盘
    - B树的非叶子结点也有数据, 拆分结点或者全表扫描都会造成较多IO
    - 红黑树要通过旋转结点来平衡, IO次数会更多

InnoDB为什么推荐使用自增ID作为主键
- 插入B+索引时, 页中的空闲空间是向一个方向增长的, 而记录用指针(偏移量)连起来, 如果自增的话, 分裂的时候比较快; 如果主键随机, 则分裂过程会很复杂, 涉及很多IO操作


## 日志
日志:
- redo log
- bin log
    - statement-base的不一致隐患
        - 与`innodb_autoinc_lock_mode=2`的冲突
        - 与`ISOLATION LEVEL=READ COMMITTED`的冲突
- undo log


## 锁

## 事务

commit如何保证原子性

隔离级别