# Chapter 01 MySQL体系结构和存储引擎

## 1.1 定义数据库和实例

**数据库** & **实例**
- 数据库: 物理操作系统文件或者其它形式文件类型的集合
    - frm, MYD, MYI, ibd
- 实例: 数据库启动后的进程, 包括若干后台线程和线程共享的共享内存区
<br/>


启动配置:
- my.ini/my.cnf
- 多配置多优化级: mysql会从多个目录去读配置文件, 其中后读的优先级更高

datadir: 指定数据库所在路径


## 1.2 MySQL体系结构

MySQL的组成部分:
- 连接池组件
- 管理服务和工具组件
- SQL接口组件
- 查询分析器组件
- 优化器组件
- 缓存(Cache)组件
- **插件式存储引擎**
- 物理文件

**存储引擎以表为单位**

//TODO

## 1.3 MySQL存储引擎

### 1.3.1 InnoDB存储引擎

InnoDB存储引擎: 面向在线联机事务处理(OLTP)
- 行锁
- 一致性非锁定读
- 外键
- 表空间: 数据存放空间的抽象. 数据放在一个逻辑的表空间中, 其实现对上层透明
    - 每个表放在单独的ibd (ver >= 4.1)
    - 支持**裸设备**: 即不经过操作系统的文件管理系统
- 多版本并发控制(MVCC): 实现4种隔离级别
- 聚集索引:
    - 如果没有唯一主键, 则定义一个6字节的ROWID
- 其它优化: 插入缓存, 二次写, 自适应哈希索引, 预读
<br/>

### 1.3.2 MyISAM引擎

MyISAM:
- 不支持事务
- 只有表锁
- 支持全文索引
- 缓存: 只缓存索引, 不缓存数据
  

### innoDB与MyISAM对比


innoDB & MyISAM对比
- 事务:
    - MyISAM不支持事务
    - innoDB支持事务, autocommit时所有语句都封闭成事务
- 外键:
    - MyISAM不支持外键
    - innoDB支持外键
        - 相关问题: 外键实现方法(强制建索引, S锁)
- 索引:
    - MyISAM用B+Tree, 但数据和索引分开, 索引叶结点存的是指针
    - innoDB**索引即数据**, 数据直接放叶结点, 并且一定要有主键, 用聚集索引实现主键
        - 辅助索引放主键
- 行数: 
    - MyISAM记录行数
        - MyISAM只有表锁, 可以通过表锁保证行数与实际行数一致
    - innoDB不记录行数, 统计要全表扫描
        - 行数对于不同事务来说可能不一样
- 压缩:
    - MyISAM的数据文件可以被压缩后查询(但压缩后不能修改)
- 文件
    - MyISAM: frm MYD(数据文件) MYI(索引文件)
    - innodb: frm ibd(表空间)
- 锁:
    - MyISAM支持表锁, innoDB支持行级页 & 表锁
- 其它:
    - innoDB特性: 二次写, 缓冲池, 一致性非锁定读(MVCC实现), 预读, 自适应索引hash

## 1.5 MySQL连接

连接方式:
- TCP/IP: ``mysql -h127.0.0.1 -uroot -p``
- UNIX域Socket: ``mysql -uroot -s /tmp/mysql.sock``
- 命名管道
- 共享内存