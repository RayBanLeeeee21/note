## 11.4 文件和记录的组织

### 11.4.1 文件组织
* 定长记录文件： 难以修改
* 变长记录文件：
    * 分槽的页结构：
        * 数据结构：
            ```YAML
            块头: 
                记录条数: n,
                空闲空间的末尾: p,
                条目:
                    起始位置: pstart
                    长度: len
                空闲空间,
                记录:
                    - 记录1
                    - 记录2
            ```
        * 行为:
            * 删除: 条目被标记为无效; 移动记录使空闲空间连续
        * 特点: 
            * 移动记录代价小
            * 不能保存大的数据

### 11.4.2 文件中组织的记录

文件中组织记录的方式:
* 堆文件组织: 记录可以保存在文件中任何地方, 只要有空间. 一般一个关系放在一个文件.
* 顺序文件组织: 记录按搜索码的值顺序存储.
* **散列文件组织**: 根据某属性的散列值来确定记录存放位置
* **多表聚类文件组织**: 在一个块中存储多个相关的关系的记录.

## 11.5 数据字典存储
数据字典存储内容:
* 必要内容:
    * 关系名
    * 关系属性名
    * 属性域及长度
    * 视图名与其定义 
    * 完整性约束
* 用户信息:
    * 用户名
    * 用户授权
    * 用户密码等
* 关系的统计数据与描述数据
    * 关系个数
    * 关系使用的存储方式 
* 关系的存储组织
* 索引:
    * 索引名
    * 被索引的关系名
    * 索引的属性
    * 构造索引的类型等


## 11.6 索引
索引类型
* 顺序索引
* 散列索引

评价因素:
* 访问类型: 找到特定属性值/属性范围的记录
* 时间开销:
    * 访问时间
    * 插入时间
    * 删除时间
* 空间开销

**搜索码**: 用于查找记录的属性或者属性值
* // 超码: 能够identify记录的属性集
* // 侯选码: (任何子集都不是超码的)最小超码
* // 主码: 被选中的候选码
    * //包含关系: $primary~key\subset{}candidate~key\subset{}super~key$

## 11.7 顺序索引
* 聚集索引/主索引: 与文件中记录存储顺序相同的搜索码对应的索引
* 非聚集索引/辅助索引: 与文件中记录存储顺序不同的其它搜索码对应的索引
* 索引顺序文件: 所有文件都按照某个搜索码顺序存储, 称为在该搜索码上有聚集索引的索引索引顺序文件

### 11.7.1 稠密索引和稀疏索引
* 稠密索引: 每个搜索码的值都有一个索引记录. 索引记录指向文件中第一个搜索码为指定值的记录
    * // 实际实现时, 索引记录可以指向一个记录的指针列表(除了聚集索引以外)
* 稀疏索引: 只为其中一些搜索码保存索引记录. 查找时先确定要找的搜索码所在的范围.

对比:
* 稠密索引: 速度较快; 空间较大
* 稀疏索引: 空间较小; 速度较慢


### 11.7.2 多级索引
多级索引

* 辅助索引必须为稠密索引:
    * 因为辅助索引的存储顺序与文件顺序不同
    * 可以通过附加的**间接指针层**来实现
    * 辅助索引的开销比较大, 要根据情况来决定某个属性是否作为搜索码

## 11.8 B+树索引文件

* B树:
    * ![B+树](Chapter_11_1_8.gif)
        * 参考:
            * B树和B+树的插入、删除图文详解 - nullzx - 博客园[^1]
            * 【经典数据结构】B树与B+树 - vincently - 博客园[^2]

## 11.9 散列文件和散列索引

* 散列文件组织: 根据搜索码计算hash函数, 保存记录到特定块/到特定块查找记录
* 散列索引组织: 根据搜索码计算hash函数, 将搜索码与指针作为记录保存到特定块/到特定块查找搜索码与对应指针

### <c>11.9.1 hash函数</c>
hash函数特点:
* 均匀:
    * 反例: 银行名首字母作为hash
* 随机: 不会与搜索码发生关联
    * 反例: 以余额数

### <c>11.9.2 桶溢出处理</c>
桶溢出:
* 桶不足
    * 解决方法: $n_b = (1+d)*\frac{n_r}{f_r}$, d为避让因子
* 偏斜
    * 解决方法: 溢出链 

### <c>11.9.3 散列索引</c>
* 聚类索引可以组织成散列文件结构, 没必要组织成散列索引结构 (因为文件本身按散列函数排序)

### <c>11.9.5 顺序索引与散列的比较

顺序索引:
* 平均查找时间与搜索码个数的对数成正比 O(log n);
* 最坏查找时间与搜索码个数的对数成正比 O(log n);
* 适于范围查找

散列索引
* 平均查找时间为常数 O(1)
* 最坏查找时间与搜索码个数成正比 O(n)
* 不适于范围查找
* 重组过程复杂, 重组时不能被访问


[^1]:(https://www.cnblogs.com/nullzx/p/8729425.html)
[^2]:(https://www.cnblogs.com/vincently/p/4526560.html)