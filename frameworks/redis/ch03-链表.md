# Chapter 03 链表


## 数据结构
-   ```c++
    typedef struct listNode{
        struct listNode* prev;
        struct listNode* next;
        void* value;      // void*指针可以指向任何类型
    };
    ```
-   ```c++
    typedef struct list{
        listNode * head;
        listNode * tail;
        unsigned int len;
        void* (*dup)(void *ptr); // 与value类型匹配的复制函数
        void (*free)(void *ptr); // 与value类型匹配的释放函数
        int (*match)(void *ptr,  // 与value类型匹配的对比函数
                     void *key) 
    };
    ```


## 应用场景
- **list类型**的实现之一
    - 压缩列表也是list的实现
- 发布与订阅
- 慢查询
- 监视器
- 服务端
        - 保存客户端信息
        - 构建客户端输出缓冲区

## 所有操作

[所有操作](http://redisdoc.com/list/index.html)(**都是原子操作**)


增
- `[LPUSH|RPUSH] key element`: 在列表左边|右边加, 无则创建列表
    - **返回**: 新长度
- `[LPUSHX|RPUSHX] key element`: 只有存在时才加
- `LINSERT key before pivot element`: 在某个旧值前|后加新值
    - **返回**: 新长度, **找不到旧值时返回-1**


删
- `[LPOP|RPOP] key element [count]`: 弹出最左|最右值, count为弹出个数
    - **返回**: 
        - 无count: 返回弹出的值, 无则返回nil.
        - 有count: 返回弹出值列表, 超出长度时弹出所有值
- `[BLPOP|BRPOP] key [key ...] timeout`: 带阻塞的pop, 列表不存在或者为空时阻塞(单位为秒)
    - `timeout=0`表示无限等待
    - **返回**: 空或者左|右值
- `LREM key count element`: 
    - count > 0: 从左开始删除count个指定值
    - count < 0: 从右开始删除-count个指定值
    - count = 0: 删除所有
    - **返回**: 新列表


改
- `LSET key index element`: 将索引为index的值改成element
    - **返回**: OK, 或报错
- `RPOPLPUSH source destination`: 从source右边弹出一个元素, push到destination左边
    - **返回**: 被弹出的元素或空
- `BRPOPLPUSH source destination timeout`: 阻塞版RPOPLPUSH, source不存在或者为空时等到timeout
    - `timeout=0`表示无限等待
    - **返回**: 被弹出的元素或空
- `LTRIM key start end`: 将范围`[start, end]`以外的值去掉
    - **返回**: OK


查
- `LLEN key`: 返回长度
- `LINDEX key index`: 
    - **返回**
        - index >= 0: 索引为index的值
        - index < 0: 索引为`len - index`的值(即从右数)
- `LRANGE key start end`: 
    - **返回**: 范围为`[start, end]`的子列表
